{
  "version": 3,
  "sources": [
    "../Users/cheahshen/AppData/Roaming/npm/node_modules/ksana-cli/node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "dualfilter-yinshun/index.js",
    "dualfilter-yinshun/src/main.jsx",
    "node_modules/ksana2015-breadcrumbtoc/breadcrumbtoc.js",
    "node_modules/ksana2015-breadcrumbtoc/dropdown_bs.js",
    "node_modules/ksana2015-breadcrumbtoc/index.js",
    "node_modules/ksana2015-dualfilter/dualfilter.js",
    "node_modules/ksana2015-dualfilter/index.js",
    "node_modules/ksana2015-htmlfileopener/htmlfileopener.js",
    "node_modules/ksana2015-htmlfileopener/index.js",
    "node_modules/ksana2015-segnav/index.js",
    "node_modules/ksana2015-segnav/segnav.js",
    "node_modules/ksana2015-webruntime/downloader.js",
    "node_modules/ksana2015-webruntime/html5fs.js",
    "node_modules/ksana2015-webruntime/ksanagap.js",
    "node_modules/ksana2015-webruntime/livereload.js",
    "node_modules/ksana2015-webruntime/mkdirp.js"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChEA;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzEA;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpEA;;ACAA;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "var React=require(\"react\");\r\nvar ReactDOM=require(\"react-dom\");\r\nrequire(\"ksana2015-webruntime/livereload\")(); \r\nvar ksanagap=require(\"ksana2015-webruntime/ksanagap\");\r\nksanagap.boot(\"dualfilter-cbeta\",function(){\r\n\tvar Main=React.createElement(require(\"./src/main.jsx\"));\r\n\tksana.mainComponent=ReactDOM.render(Main,document.getElementById(\"main\"));\r\n});",
    "/*\r\nTODO _@80 cannot navigate\r\n*/\r\nvar React=require(\"react\");\r\nvar E=React.createElement;\r\nvar ksa=require(\"ksana-simple-api\");\r\nvar DualFilter=require(\"ksana2015-dualfilter\").Component;\r\nvar HTMLFileOpener=require(\"ksana2015-htmlfileopener\").Component;\r\nvar BreadcrumbTOC=require(\"ksana2015-breadcrumbtoc\").Component;\r\nvar SegNav=require(\"ksana2015-segnav\").Component;\r\nvar db=\"yinshun\";\r\nvar styles={\r\n  container:{display:\"flex\"}\r\n  ,dualfilter:{flex:1,height:\"100%\",overflowY:\"auto\"}\r\n  ,rightpanel:{flex:3}\r\n  ,input:{fontSize:\"100%\",width:\"100%\"}\r\n}\r\nvar maincomponent = React.createClass({displayName: \"maincomponent\",\r\n  getInitialState:function() {\r\n    return {items:[],itemclick:\" \",text:\"\",tofind1:\"\",q:\"\",toc:[],rawhits:[],\r\n            vpos:0,localmode:false,ready:false,segnames:[],txtid:\"\",\r\n            tofind1:localStorage.getItem(\"yinshun-tofind1\")||\"般若\",q:localStorage.getItem(\"yinshun-q\")||\"淨土\"};\r\n  }\r\n  ,componentDidMount:function() {\r\n    ksa.tryOpen(db,function(err){\r\n      if (!err) {\r\n        this.setState({ready:true});\r\n      } else {\r\n        this.setState({localmode:true});\r\n      }\r\n    }.bind(this));\r\n  }\r\n  ,onFilter:function(tofind1,q) {\r\n    var that=this;\r\n    ksa.filter({db:db,regex:tofind1,q:q,field:\"head\"},function(err,items){\r\n\r\n      localStorage.setItem(\"yinshun-tofind1\",tofind1);\r\n      localStorage.setItem(\"yinshun-q\",q);\r\n      if (items.length&&items[0].hits&&items[0].hits.length) {\r\n        items.sort(function(i1,i2){return i2.hits.length-i1.hits.length});\r\n      }\r\n      \r\n      ksa.toc({db:db,q:q,tocname:\"head\"},function(err,res){\r\n        that.setState({items:items,tofind1:tofind1,q:q,toc:res.toc,rawhits:res.hits},function(){\r\n          that.fetchText(items[0].vpos);\r\n        });\r\n        if (!that.state.segnames.length) {\r\n          ksa.get(db,\"segnames\",function(segnames){\r\n            that.setState({segnames: segnames});\r\n          });\r\n        }\r\n      })\r\n    });\r\n  }\r\n  ,fetchText:function(vpos){\r\n    ksa.fetch({db:db,vpos:vpos,q:this.state.q},function(err,content){\r\n      if (!content || !content.length) return;\r\n      this.setState({vpos:vpos,text:content[0].text,hits:content[0].hits,txtid:content[0].uti}); \r\n\r\n    }.bind(this));\r\n  }\r\n  ,onItemClick:function(idx) {\r\n    this.fetchText(this.state.items[idx].vpos);\r\n  }\r\n  ,renderText:function() {\r\n    return ksa.renderHits(this.state.text,this.state.hits,E.bind(null,\"span\"));\r\n  }\r\n  ,onFileReady:function(files) {\r\n    this.setState({localmode:false,ready:true});\r\n    db=files[db];//replace dbid with HTML File handle\r\n  }\r\n  ,renderOpenKDB:function() {\r\n    if (!this.state.localmode)return React.createElement(\"div\", null, \"Loading \", db);\r\n    return React.createElement(\"div\", null, \r\n      React.createElement(\"h2\", null, \"Dual Filter for Yinshun\"), \r\n      React.createElement(HTMLFileOpener, {onReady: this.onFileReady}), \r\n      React.createElement(\"br\", null), \"Google Chrome Only\", \n      React.createElement(\"br\", null), React.createElement(\"a\", {target: \"_new\", href: \"https://github.com/yinshun/dualfilter-yinshun\"}, \"Github Repo\")\r\n    )\r\n  }\r\n  ,onBreadcrumbSelect:function(itemidx,vpos) {\r\n    this.fetchText(vpos);\r\n  }\r\n  ,onGoSegment:function(seg) {\r\n    ksa.uti2vpos({db:db,uti:seg},function(err,vpos){\r\n      if (!err) this.fetchText(vpos);\r\n    }.bind(this));\r\n  }\r\n  ,render: function() {\r\n    if (!this.state.ready) return this.renderOpenKDB();\r\n    return React.createElement(\"div\", {style: styles.container}, \r\n      React.createElement(\"div\", {style: styles.dualfilter}, \r\n        React.createElement(DualFilter, {items: this.state.items, \r\n          inputstyle: styles.input, \r\n          tofind1: this.state.tofind1, \r\n          tofind2: this.state.q, \r\n          onItemClick: this.onItemClick, \r\n          onFilter: this.onFilter})\r\n      ), \r\n      React.createElement(\"div\", {style: styles.rightpanel}, \r\n\r\n      React.createElement(BreadcrumbTOC, {toc: this.state.toc, vpos: this.state.vpos, hits: this.state.rawhits, treenodeHits: ksa.treenodehits, \r\n          onSelect: this.onBreadcrumbSelect, buttonClass: \"btn btn-link\", separator: \"/\"}), \r\n\r\n        React.createElement(SegNav, {size: 11, segs: this.state.segnames, value: this.state.txtid, onGoSegment: this.onGoSegment}), \r\n        React.createElement(\"br\", null), \r\n        this.renderText()\r\n      )\r\n    )    \r\n  }\r\n});\r\nmodule.exports=maincomponent;",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\nvar buildToc = function(toc) {\r\n\tif (!toc || !toc.length || toc.built) return;\r\n\tvar depths=[];\r\n \tvar prev=0;\r\n \tfor (var i=0;i<toc.length;i++) delete toc[i].n;\r\n\tfor (var i=0;i<toc.length;i++) {\r\n\t    var depth=toc[i].d||toc[i].depth;\r\n\t    if (prev>depth) { //link to prev sibling\r\n\t      if (depths[depth]) toc[depths[depth]].n = i;\r\n\t      for (var j=depth;j<prev;j++) depths[j]=0;\r\n\t    }\r\n    \tdepths[depth]=i;\r\n    \tprev=depth;\r\n\t}\r\n\ttoc.built=true;\r\n\treturn toc;\r\n}\r\nvar getChildren = function(toc,n) {\r\n\tif (!toc[n]||!toc[n+1] ||toc[n+1].d!==toc[n].d+1) return [];\r\n\tvar out=[],next=n+1;\r\n\twhile (next) {\r\n\t\tout.push(next);\r\n\t\tif (!toc[next+1])break;\r\n\t\tif (toc[next].d==toc[next+1].d) {\r\n\t\t\tnext++;\r\n\t\t} else if (toc[next].n){\r\n\t\t\tnext=toc[next].n;\t\t\t\r\n\t\t} else {\r\n\t\t\tnext=0;\r\n\t\t}\r\n\t}\r\n\treturn out;\r\n}\r\nvar BreadcrumbTOC=React.createClass({\r\n\tpropTypes:{\r\n\t\ttoc:PT.array.isRequired\r\n\t\t,hits:PT.array\r\n\t\t,onSelect:PT.func\r\n\t\t,vpos:PT.number  //jump with vpos\r\n\t\t,keyword:PT.string\r\n\t\t,treenodeHits:PT.func\r\n\t\t,buttonClass:PT.string\r\n\t\t,separator:PT.node\r\n\t}\r\n\t,componentWillReceiveProps:function(nextProps,nextState) {\r\n\t\tif (nextProps.toc && !nextProps.toc.built) {\r\n\t\t\tbuildToc(nextProps.toc);\r\n\t\t}\r\n\t\tif (nextProps.hits!==this.props.hits) {\r\n\t\t\tthis.clearHits();\r\n\t\t}\r\n\t}\r\n\t,componentWillMount:function(){\r\n\t\tbuildToc(this.props.toc);\r\n\t}\r\n\t,getInitialState:function(){\r\n\t\treturn {};\r\n\t}\r\n\t,clearHits:function() {\r\n\t\tfor (var i=0;i<this.props.toc;i++) {\r\n\t\t\tif (this.props.toc[i].hit) delete this.props.toc[i].hit;\r\n\t\t}\r\n\t}\r\n\t,onSelect:function(idx,children,level) {\r\n\t\tthis.props.onSelect && this.props.onSelect(idx, children[idx].vpos+1);//don't know why???\r\n\t}\r\n\t,closestItem:function(tocitems,vpos) {\r\n\t\tfor (i=1;i<tocitems.length;i++) {\r\n\t\t\tif (this.props.toc[tocitems[i]].vpos>=vpos) return i-1;\r\n\t\t}\r\n\t\treturn tocitems.length-1;\r\n\t}\r\n\t,renderCrumbs:function() {\r\n\t\tvar dropdown=require(\"./dropdown_bs\");\r\n\t\tvar cur=0,toc=this.props.toc,out=[],level=0;\r\n\t\tvar children=getChildren(toc,cur),nextchildren;\r\n\t\tdo {\r\n\t\t\tvar selected = this.closestItem(children,this.props.vpos) ;\r\n\t\t\tcur=children[selected];\r\n\r\n\t\t\tvar items=children.map(function(child){\r\n\t\t\t\tvar hit=toc[child].hit;\r\n\t\t\t\tif (this.props.hits && isNaN(hit) && this.props.treenodeHits) {\r\n\t\t\t\t\thit=this.props.treenodeHits( toc,this.props.hits,child);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {t:toc[child].t,idx:child,hit:hit,vpos:toc[child].vpos};\r\n\t\t\t}.bind(this));\r\n\r\n\t\t\tnextchildren=getChildren(toc,cur);\r\n\r\n\t\t\tout.push(E(dropdown,{onSelect:this.onSelect,level:level,\r\n\t\t\t\tseparator:nextchildren.length?this.props.separator:null,//last separator is not shown\r\n\t\t\t\tbuttonClass:this.props.buttonClass,\r\n\t\t\t\tkey:out.length,selected:selected,items:items,keyword:this.props.keyword}) );\r\n\t\t\t//if (out.length>5) break;\r\n\t\t\tlevel++;\r\n\t\t\tif (!nextchildren.length) break;\r\n\t\t\tchildren=nextchildren;\r\n\t\t} while (true);\r\n\t\treturn out;\r\n\t}\r\n\t,render:function(){\r\n\t\treturn E(\"div\",{},this.renderCrumbs());\r\n\t}\r\n})\r\nmodule.exports=BreadcrumbTOC;",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\n\r\nvar BreadCrumbDropdown=React.createClass({\r\n\tpropTypes:{\r\n\t\titems:PT.array.isRequired\r\n\t\t,selected:PT.number\r\n\t\t,onSelect:PT.func\r\n\t\t,level:PT.number.isRequired //which level\r\n\t\t,keyword:PT.string\r\n\t}\r\n\t,getDefaultProp:function(){\r\n\t\treturn {items:[]}\r\n\t}\r\n\t,onSelect:function(e) {\r\n\t\tdomnode=e.target.parentElement;\r\n\t\tvar idx=-1;\r\n\t\twhile (domnode) {\r\n\t\t\tif (domnode.classList.contains(\"open\")) domnode.classList.remove(\"open\");\r\n\t\t\tif (domnode.dataset && domnode.dataset.idx) idx=parseInt(domnode.dataset.idx);\r\n\t\t\tdomnode=domnode.parentElement;\r\n\t\t}\r\n\t\tthis.props.onSelect&&this.props.onSelect(idx,this.props.items,this.props.level);\r\n\t}\r\n\t,renderKeyword:function(t) {\r\n\t\tif (this.props.keyword) {\r\n\t\t\tvar o=[],lastidx=0;\r\n\t\t\tt.replace(new RegExp(this.props.keyword,\"g\"),function(m,idx){\r\n\t\t\t\to.push(t.substr(lastidx,idx));\r\n\t\t\t\to.push(E(\"span\",{key:idx,style:{color:\"red\"}},m));\r\n\t\t\t\tlastidx=idx+m.length;\r\n\t\t\t});\r\n\t\t\to.push(t.substr(lastidx));\r\n\t\t\tt=o;\r\n\t\t}\r\n\t\treturn t;\r\n\t}\r\n\t,renderItem:function(item,idx) {\r\n\t\tvar hit=null;\r\n\t\tvar style={cursor:\"pointer\"};\r\n\t\tif (this.props.selected==idx) style.background=\"highlight\"\r\n\t\titem.hit&&(hit=E(\"span\",{style:{color:\"red\"},className:\"pull-right\"},item.hit));\r\n\t\tvar t=this.renderKeyword(item.t);\r\n\t\treturn E(\"li\",{key:idx,\"data-idx\":idx},E(\"a\",{style:style,onClick:this.onSelect},t,hit));\r\n\t}\r\n\r\n\t,open:function(e){\r\n\t\te.target.parentElement.classList.add(\"open\");\r\n\t}\r\n\t,render:function(){\r\n\t\tvar item=this.props.items[this.props.selected];\r\n\t\tif (!item)return E(\"span\");\r\n\t\tvar title=item.t;\r\n\r\n\t\titem.hit&&(title=[E(\"span\",{key:1},item.t),E(\"span\",{key:2,className:\"hl0 pull-right\"},item.hit||\"\")]);\r\n\t\treturn E(\"span\",{className:\"dropdown\"},\r\n\t\t\t\tE(\"button\",{key:\"drop\",\"data-toggle\":\"dropdown\",className:this.props.buttonClass||\"btn btn-default\",\r\n\t\t\t\t\tonClick:this.open}, this.props.items[this.props.selected].t ),\r\n\t\t\t\tthis.props.separator,\r\n\t\t\t\tE(\"ul\",{className:\"dropdown-menu open\",id:\"for_shutting_warning_up\",title:this.renderKeyword(title)},\r\n\t\t\tthis.props.items.map(this.renderItem)));\r\n\t}\r\n});\r\nmodule.exports=BreadCrumbDropdown;",
    "module.exports={Component:require(\"./breadcrumbtoc\")};",
    "var React=require(\"react\");\r\nvar ReactList=require(\"react-list\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\n\r\nvar styles={\r\n  item:{cursor:\"pointer\"}\r\n}\r\nvar DualFilter=React.createClass({\r\n  getInitialState:function(){\r\n    return {tofind1:this.props.tofind1||\"\",tofind2:this.props.tofind2||\"\"};\r\n  }\r\n  ,componentDidMount:function() {\r\n    if (this.state.tofind1||this.state.tofind2) {\r\n      this.preparesearch();\r\n    }\r\n  }\r\n  ,getDefaultProps:function(){\r\n    return {items:[]};\r\n  }\r\n  ,propTypes:{\r\n    items:PT.array.isRequired\r\n    ,onFilter:PT.func.isRequired\r\n    ,onItemClick:PT.func.isRequired\r\n    ,inputstyle:PT.object\r\n    ,inputclass:PT.oneOfType([PT.string, PT.func])\r\n\r\n  }\r\n  ,renderHit:function(hit) {\r\n    return E(\"span\",{className:\"hl0\"},hit);\r\n  }\r\n  ,itemClick:function(e) {\r\n    ele=e.target;\r\n    if (!(ele.dataset &&ele.dataset.idx)) ele=ele.parentElement;\r\n    var idx=parseInt(ele.dataset.idx);\r\n    this.props.onItemClick(idx);\r\n  }\r\n  ,renderItem:function(i,idx){\r\n    var hit=(this.props.items[i].hits||[]).length||\"\";\r\n    var vpos=this.props.items[i].vpos||0;\r\n    return E(\"div\",{key:idx,style:styles.item\r\n      ,\"data-vpos\":vpos\r\n      ,\"data-idx\":idx\r\n      ,\"data-hit\":hit\r\n      ,onClick:this.itemClick},this.props.items[i].text,this.renderHit.call(this,hit));\r\n  }\r\n  ,preparesearch:function() {\r\n    clearTimeout(this.timer);\r\n    this.timer=setTimeout(function(){\r\n      this.props.onFilter(this.state.tofind1,this.state.tofind2);\r\n    }.bind(this),500);    \r\n  }\r\n  ,onChange1:function(e) {\r\n    this.setState({tofind1:e.target.value});\r\n    this.preparesearch();\r\n  }\r\n  ,onChange2:function(e) {\r\n    this.setState({tofind2:e.target.value});\r\n    this.preparesearch();\r\n  }\r\n\t,render:function() {\r\n    var Input=this.props.inputclass||\"input\";\r\n\t\treturn E(\"div\",null,\r\n      E(Input,{placeholder:\"regular expression\",style:this.props.inputstyle,value:this.state.tofind1,onChange:this.onChange1})\r\n      ,E(\"br\")\r\n      ,E(Input,{placeholder:\"full text search\",style:this.props.inputstyle,value:this.state.tofind2,onChange:this.onChange2})\r\n      ,E(\"br\")\r\n      ,E(\"span\",null,\"match count:\",this.props.items.length)\r\n      ,E(\"br\")\r\n      ,E(ReactList,{itemRenderer:this.renderItem,length:this.props.items.length})\r\n    )\r\n\t}\r\n})\r\nmodule.exports=DualFilter;",
    "module.exports={Component:require(\"./dualfilter\")};",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\nvar styles={\r\n\tready:{backgroundColor:\"green\",color:\"yellow\"}\r\n}\r\nvar getFilesFromKsanajs=function() {\r\n\tvar o={};\r\n\tksana.js.files.map(function(file){\r\n\t\tif (file.substr(file.length-4)!==\".kdb\") return;\r\n\t\tkdbid=file.substr(file.lastIndexOf(\"/\")+1);\r\n\t\tkdbid=kdbid.substr(0,kdbid.length-4);\r\n\r\n\t\to[kdbid]=file;\r\n\t});\r\n\treturn o;\r\n}\r\nvar HTMLFileOpener=React.createClass({\r\n\tpropTypes:{\r\n\t\tfiles:PT.object // { kdbid:url}\r\n\t\t,onReady:PT.func.isRequired\r\n\t}\r\n\t,getInitialState:function() {\r\n\t\treturn {ready:{} };\r\n\t}\r\n\t,renderStatus:function(kdbid,url) {\r\n\t\tif(this.state.ready[kdbid]){\r\n\t\t\treturn E(\"span\",{style:styles.ready},\"Ready\");\r\n\t\t} else {\r\n\t\t\treturn E(\"span\",null,E(\"a\",{href:url},\"Download \"));\r\n\t\t}\r\n\t}\r\n\t,renderFileStatus:function(){\r\n\t\tvar o=[];\r\n\t\tfor (var kdbid in this.props.files) {\r\n\t\t\tvar url=this.props.files[kdbid];\r\n\t\t\to.push(E(\"div\",{key:kdbid},kdbid+\".kdb \",this.renderStatus(kdbid,url)));\r\n\t\t}\r\n\t\treturn o;\r\n\t}\r\n\t,getDefaultProps:function(){\r\n\t\treturn {files:getFilesFromKsanajs()};\r\n\t}\r\n\t,openFile:function(e) {\r\n\t\tvar files=e.target.files;\r\n\t\tvar ready=this.state.ready;\r\n\t\tfor (var i=0;i<files.length;i++) {\r\n\t\t\tvar kdbid=files[i].name;\r\n\t\t\tkdbid=kdbid.substr(0,kdbid.length-4);\r\n\t\t\tif (this.props.files[kdbid]) {\r\n\t\t\t\tready[kdbid]=files[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Object.keys(ready).length==Object.keys(this.props.files).length) {\r\n\t\t\tthis.props.onReady(ready);\r\n\t\t}\r\n\t\tthis.setState({ready:ready});\r\n\t}\r\n\t,render:function() {\r\n\t\tvar opts={type:\"file\", accept:\".kdb\", onChange:this.openFile}\r\n\t\tif (Object.keys(this.props.files).length>1) opts.multiple=\"multiple\";\r\n    return E(\"div\",null\r\n    \t, this.renderFileStatus()\r\n    \t, E(\"input\",opts)\r\n    \t,\"click download if you don't have the kdb on your disk\"\r\n    );\r\n\t}\r\n});\r\nmodule.exports=HTMLFileOpener;",
    "module.exports={Component:require(\"./htmlfileopener\")};",
    "module.exports={Component:require(\"./segnav\")};",
    "var React=require(\"react\");\r\n\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\nvar SegNav=React.createClass({\r\n\tpropTypes:{\r\n\t\t\"segpat\":PT.string\r\n\t\t,\"value\":PT.string\r\n\t\t,\"segs\":PT.array.isRequired\r\n\t\t,\"onGoSegment\":PT.func\r\n\t}\r\n\t,getInitialState:function() {\r\n\t\treturn {segs:this.props.segs};\r\n\t}\r\n\t,componentWillMount:function() {\r\n\t\tthis.btn=this.props.button||\"button\";\r\n\t\tif (this.props.segpat) {\r\n\t\t\tvar regex=new RegExp(this.props.segpat);\r\n\t\t\tvar segnames={};\r\n\t\t\tthis.props.segs.forEach(function(seg){\r\n\t\t\t\tvar m=seg.match(regex);\r\n\t\t\t\tif (m && !segnames[m[1]]) segnames[m[1]]=true;\r\n\t\t\t});\r\n\t\t\tvar segs=Object.keys(segnames);\r\n\t\t\tvar segnow=segs.indexOf(this.props.value)||0;\r\n\t\t\tthis.setState({segs:segs,segnow:segnow,segname:this.state.segs[segnow]});\r\n\t\t}\r\n\t}\r\n\t,componentWillReceiveProps:function(nextProps,nextState) {\r\n\t\tvar idx=nextProps.segs.indexOf(nextProps.value);\r\n\t\tif (idx>-1) {\r\n\t\t\tthis.setState({segnow:idx,segname:this.state.segs[idx]});\r\n\t\t}\r\n\t\tif (this.state.segs!==nextProps.segs) this.setState({segs:nextProps.segs});\r\n\t\t\r\n\t}\r\n\t,goSeg:function(idx) {\r\n\t\tthis.setState({segnow:idx,segname:this.state.segs[idx]});\r\n\t\tthis.props.onGoSegment&&this.props.onGoSegment(this.state.segs[idx]);\r\n\t}\r\n\t,prev:function() {\r\n\t\tvar segnow=this.state.segnow;\r\n\t\tif (segnow>0) segnow--;\r\n\t\tthis.goSeg(segnow);\r\n\t}\r\n\t,next:function(){\r\n\t\tvar segnow=this.state.segnow;\r\n\t\tif (segnow<this.state.segs.length-1) segnow++;\r\n\t\tthis.goSeg(segnow);\r\n\t}\r\n\t,onKeyPress:function(e) {\r\n\t\tif (e.key==\"Enter\") {\r\n\t\t\tvar idx=this.state.segs.indexOf(e.target.value);\r\n\t\t\tif (idx>-1) this.goSeg(idx);\r\n\t\t}\r\n\t}\r\n\t,onChange:function(e) {\r\n\t\tvar segname=e.target.value;\r\n\t\tvar idx=this.state.segs.indexOf(segname);\r\n\t\tthis.setState({segname:segname});\r\n\t\tclearTimeout(this.timer);\r\n\t\tthis.timer=setTimeout(function(){\r\n\t\t\tif (idx>-1) this.goSeg(idx);\r\n\t\t\telse {\r\n\t\t\t\tthis.refs.seg.getDOMNode().value=this.state.segs[this.state.segnow];\r\n\t\t\t}\r\n\t\t}.bind(this),2000);\r\n\t}\r\n\t,render : function() {\r\n\t\treturn E(\"span\",null,\r\n\t\t\tE(this.btn,{style:this.props.style,onClick:this.prev,disabled:this.state.segnow==0},\"←\"),\r\n\t\t\tE(\"input\",{size:this.props.size||8,style:this.props.style,ref:\"seg\",value:this.state.segname,onKeyPress:this.onKeyPress,onChange:this.onChange}),\r\n\t\t\tE(this.btn,{style:this.props.style,onClick:this.next,disabled:this.state.segnow==this.state.segs.length-1},\"→\")\r\n\t\t);\r\n\t}\r\n})\r\nmodule.exports=SegNav;",
    "\r\nvar userCancel=false;\r\nvar files=[];\r\nvar totalDownloadByte=0;\r\nvar targetPath=\"\";\r\nvar tempPath=\"\";\r\nvar nfile=0;\r\nvar baseurl=\"\";\r\nvar result=\"\";\r\nvar downloading=false;\r\nvar startDownload=function(dbid,_baseurl,_files) { //return download id\r\n\tvar fs     = require(\"fs\");\r\n\tvar path   = require(\"path\");\r\n\r\n\t\r\n\tfiles=_files.split(\"\\uffff\");\r\n\tif (downloading) return false; //only one session\r\n\tuserCancel=false;\r\n\ttotalDownloadByte=0;\r\n\tnextFile();\r\n\tdownloading=true;\r\n\tbaseurl=_baseurl;\r\n\tif (baseurl[baseurl.length-1]!='/')baseurl+='/';\r\n\ttargetPath=ksanagap.rootPath+dbid+'/';\r\n\ttempPath=ksanagap.rootPath+\".tmp/\";\r\n\tresult=\"\";\r\n\treturn true;\r\n}\r\n\r\nvar nextFile=function() {\r\n\tsetTimeout(function(){\r\n\t\tif (nfile==files.length) {\r\n\t\t\tnfile++;\r\n\t\t\tendDownload();\r\n\t\t} else {\r\n\t\t\tdownloadFile(nfile++);\t\r\n\t\t}\r\n\t},100);\r\n}\r\n\r\nvar downloadFile=function(nfile) {\r\n\tvar url=baseurl+files[nfile];\r\n\tvar tmpfilename=tempPath+files[nfile];\r\n\tvar mkdirp = require(\"./mkdirp\");\r\n\tvar fs     = require(\"fs\");\r\n\tvar http   = require(\"http\");\r\n\r\n\tmkdirp.sync(path.dirname(tmpfilename));\r\n\tvar writeStream = fs.createWriteStream(tmpfilename);\r\n\tvar datalength=0;\r\n\tvar request = http.get(url, function(response) {\r\n\t\tresponse.on('data',function(chunk){\r\n\t\t\twriteStream.write(chunk);\r\n\t\t\ttotalDownloadByte+=chunk.length;\r\n\t\t\tif (userCancel) {\r\n\t\t\t\twriteStream.end();\r\n\t\t\t\tsetTimeout(function(){nextFile();},100);\r\n\t\t\t}\r\n\t\t});\r\n\t\tresponse.on(\"end\",function() {\r\n\t\t\twriteStream.end();\r\n\t\t\tsetTimeout(function(){nextFile();},100);\r\n\t\t});\r\n\t});\r\n}\r\n\r\nvar cancelDownload=function() {\r\n\tuserCancel=true;\r\n\tendDownload();\r\n}\r\nvar verify=function() {\r\n\treturn true;\r\n}\r\nvar endDownload=function() {\r\n\tnfile=files.length+1;//stop\r\n\tresult=\"cancelled\";\r\n\tdownloading=false;\r\n\tif (userCancel) return;\r\n\tvar fs     = require(\"fs\");\r\n\tvar mkdirp = require(\"./mkdirp\");\r\n\r\n\tfor (var i=0;i<files.length;i++) {\r\n\t\tvar targetfilename=targetPath+files[i];\r\n\t\tvar tmpfilename   =tempPath+files[i];\r\n\t\tmkdirp.sync(path.dirname(targetfilename));\r\n\t\tfs.renameSync(tmpfilename,targetfilename);\r\n\t}\r\n\tif (verify()) {\r\n\t\tresult=\"success\";\r\n\t} else {\r\n\t\tresult=\"error\";\r\n\t}\r\n}\r\n\r\nvar downloadedByte=function() {\r\n\treturn totalDownloadByte;\r\n}\r\nvar doneDownload=function() {\r\n\tif (nfile>files.length) return result;\r\n\telse return \"\";\r\n}\r\nvar downloadingFile=function() {\r\n\treturn nfile-1;\r\n}\r\n\r\nvar downloader={startDownload:startDownload, downloadedByte:downloadedByte,\r\n\tdownloadingFile:downloadingFile, cancelDownload:cancelDownload,doneDownload:doneDownload};\r\nmodule.exports=downloader;",
    "/* emulate filesystem on html5 browser */\r\nvar get_head=function(url,field,cb){\r\n\tvar xhr = new XMLHttpRequest();\r\n\txhr.open(\"HEAD\", url, true);\r\n\txhr.onreadystatechange = function() {\r\n\t\t\tif (this.readyState == this.DONE) {\r\n\t\t\t\tcb(xhr.getResponseHeader(field));\r\n\t\t\t} else {\r\n\t\t\t\tif (this.status!==200&&this.status!==206) {\r\n\t\t\t\t\tcb(\"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t};\r\n\txhr.send();\r\n}\r\nvar get_date=function(url,cb) {\r\n\tget_head(url,\"Last-Modified\",function(value){\r\n\t\tcb(value);\r\n\t});\r\n}\r\nvar get_size=function(url, cb) {\r\n\tget_head(url,\"Content-Length\",function(value){\r\n\t\tcb(parseInt(value));\r\n\t});\r\n};\r\nvar checkUpdate=function(url,fn,cb) {\r\n\tif (!url) {\r\n\t\tcb(false);\r\n\t\treturn;\r\n\t}\r\n\tget_date(url,function(d){\r\n\t\tAPI.fs.root.getFile(fn, {create: false, exclusive: false}, function(fileEntry) {\r\n\t\t\tfileEntry.getMetadata(function(metadata){\r\n\t\t\t\tvar localDate=Date.parse(metadata.modificationTime);\r\n\t\t\t\tvar urlDate=Date.parse(d);\r\n\t\t\t\tcb(urlDate>localDate);\r\n\t\t\t});\r\n\t\t},function(){\r\n\t\t\tcb(false);\r\n\t\t});\r\n\t});\r\n}\r\nvar download=function(url,fn,cb,statuscb,context) {\r\n\t var totalsize=0,batches=null,written=0;\r\n\t var fileEntry=0, fileWriter=0;\r\n\t var createBatches=function(size) {\r\n\t\tvar bytes=1024*1024, out=[];\r\n\t\tvar b=Math.floor(size / bytes);\r\n\t\tvar last=size %bytes;\r\n\t\tfor (var i=0;i<=b;i++) {\r\n\t\t\tout.push(i*bytes);\r\n\t\t}\r\n\t\tout.push(b*bytes+last);\r\n\t\treturn out;\r\n\t }\r\n\t var finish=function() {\r\n\t\t rm(fn,function(){\r\n\t\t\t\tfileEntry.moveTo(fileEntry.filesystem.root, fn,function(){\r\n\t\t\t\t\tsetTimeout( cb.bind(context,false) , 0) ;\r\n\t\t\t\t},function(e){\r\n\t\t\t\t\tconsole.log(\"failed\",e)\r\n\t\t\t\t});\r\n\t\t },this);\r\n\t };\r\n\t\tvar tempfn=\"temp.kdb\";\r\n\t\tvar batch=function(b) {\r\n\t\tvar abort=false;\r\n\t\tvar xhr = new XMLHttpRequest();\r\n\t\tvar requesturl=url+\"?\"+Math.random();\r\n\t\txhr.open('get', requesturl, true);\r\n\t\txhr.setRequestHeader('Range', 'bytes='+batches[b]+'-'+(batches[b+1]-1));\r\n\t\txhr.responseType = 'blob';\r\n\t\txhr.addEventListener('load', function() {\r\n\t\t\tvar blob=this.response;\r\n\t\t\tfileEntry.createWriter(function(fileWriter) {\r\n\t\t\t\tfileWriter.seek(fileWriter.length);\r\n\t\t\t\tfileWriter.write(blob);\r\n\t\t\t\twritten+=blob.size;\r\n\t\t\t\tfileWriter.onwriteend = function(e) {\r\n\t\t\t\t\tif (statuscb) {\r\n\t\t\t\t\t\tabort=statuscb.apply(context,[ fileWriter.length / totalsize,totalsize ]);\r\n\t\t\t\t\t\tif (abort) setTimeout( cb.bind(context,false) , 0) ;\r\n\t\t\t\t \t}\r\n\t\t\t\t\tb++;\r\n\t\t\t\t\tif (!abort) {\r\n\t\t\t\t\t\tif (b<batches.length-1) setTimeout(batch.bind(context,b),0);\r\n\t\t\t\t\t\telse                    finish();\r\n\t\t\t\t \t}\r\n\t\t\t \t};\r\n\t\t\t}, console.error);\r\n\t\t},false);\r\n\t\txhr.send();\r\n\t}\r\n\r\n\tget_size(url,function(size){\r\n\t\ttotalsize=size;\r\n\t\tif (!size) {\r\n\t\t\tif (cb) cb.apply(context,[false]);\r\n\t\t} else {//ready to download\r\n\t\t\trm(tempfn,function(){\r\n\t\t\t\t batches=createBatches(size);\r\n\t\t\t\t if (statuscb) statuscb.apply(context,[ 0, totalsize ]);\r\n\t\t\t\t API.fs.root.getFile(tempfn, {create: 1, exclusive: false}, function(_fileEntry) {\r\n\t\t\t\t\t\t\tfileEntry=_fileEntry;\r\n\t\t\t\t\t\tbatch(0);\r\n\t\t\t\t });\r\n\t\t\t},this);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nvar readFile=function(filename,cb,context) {\r\n\tAPI.fs.root.getFile(filename, {create: false, exclusive: false},function(fileEntry) {\r\n\t\tfileEntry.file(function(file){\r\n\t\t\tvar reader = new FileReader();\r\n\t\t\treader.onloadend = function(e) {\r\n\t\t\t\tif (cb) cb.call(cb,this.result);\r\n\t\t\t};\r\n\t\t\treader.readAsText(file,\"utf8\");\r\n\t\t});\r\n\t}, console.error);\r\n}\r\n\r\nfunction createDir(rootDirEntry, folders,  cb) {\r\n  // Throw out './' or '/' and move on to prevent something like '/foo/.//bar'.\r\n  if (folders[0] == '.' || folders[0] == '') {\r\n    folders = folders.slice(1);\r\n  }\r\n  rootDirEntry.getDirectory(folders[0], {create: true}, function(dirEntry) {\r\n    // Recursively add the new subfolder (if we still have another to create).\r\n    if (folders.length) {\r\n      createDir(dirEntry, folders.slice(1),cb);\r\n    } else {\r\n\t\t\tcb();\r\n\t\t}\r\n  }, cb);\r\n};\r\n\r\n\r\nvar writeFile=function(filename,buf,cb,context){\r\n\tvar write=function(fileEntry){\r\n\t\tfileEntry.createWriter(function(fileWriter) {\r\n\t\t\tfileWriter.write(buf);\r\n\t\t\tfileWriter.onwriteend = function(e) {\r\n\t\t\t\tif (cb) cb.apply(cb,[buf.byteLength]);\r\n\t\t\t};\r\n\t\t}, console.error);\r\n\t}\r\n\r\n\tvar getFile=function(filename){\r\n\t\tAPI.fs.root.getFile(filename, {exclusive:true}, function(fileEntry) {\r\n\t\t\twrite(fileEntry);\r\n\t\t}, function(){\r\n\t\t\t\tAPI.fs.root.getFile(filename, {create:true,exclusive:true}, function(fileEntry) {\r\n\t\t\t\t\twrite(fileEntry);\r\n\t\t\t\t});\r\n\r\n\t\t});\r\n\t}\r\n\tvar slash=filename.lastIndexOf(\"/\");\r\n\tif (slash>-1) {\r\n\t\tcreateDir(API.fs.root, filename.substr(0,slash).split(\"/\"),function(){\r\n\t\t\tgetFile(filename);\r\n\t\t});\r\n\t} else {\r\n\t\tgetFile(filename);\r\n\t}\r\n}\r\n\r\nvar readdir=function(cb,context) {\r\n\tvar dirReader = API.fs.root.createReader();\r\n\tvar out=[],that=this;\r\n\tdirReader.readEntries(function(entries) {\r\n\t\tif (entries.length) {\r\n\t\t\tfor (var i = 0, entry; entry = entries[i]; ++i) {\r\n\t\t\t\tif (entry.isFile) {\r\n\t\t\t\t\tout.push([entry.name,entry.toURL ? entry.toURL() : entry.toURI()]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tAPI.files=out;\r\n\t\tif (cb) cb.apply(context,[out]);\r\n\t}, function(){\r\n\t\tif (cb) cb.apply(context,[null]);\r\n\t});\r\n}\r\nvar getFileURL=function(filename) {\r\n\tif (!API.files ) return null;\r\n\tvar file= API.files.filter(function(f){return f[0]==filename});\r\n\tif (file.length) return file[0][1];\r\n}\r\nvar rm=function(filename,cb,context) {\r\n\tvar url=getFileURL(filename);\r\n\tif (url) rmURL(url,cb,context);\r\n\telse if (cb) cb.apply(context,[false]);\r\n}\r\n\r\nvar rmURL=function(filename,cb,context) {\r\n\twebkitResolveLocalFileSystemURL(filename, function(fileEntry) {\r\n\t\tfileEntry.remove(function() {\r\n\t\t\tif (cb) cb.apply(context,[true]);\r\n\t\t}, console.error);\r\n\t},  function(e){\r\n\t\tif (cb) cb.apply(context,[false]);//no such file\r\n\t});\r\n}\r\nfunction errorHandler(e) {\r\n\tconsole.error('Error: ' +e.name+ \" \"+e.message);\r\n}\r\nvar initfs=function(grantedBytes,cb,context) {\r\n\twebkitRequestFileSystem(PERSISTENT, grantedBytes,  function(fs) {\r\n\t\tAPI.fs=fs;\r\n\t\tAPI.quota=grantedBytes;\r\n\t\treaddir(function(){\r\n\t\t\tAPI.initialized=true;\r\n\t\t\tcb.apply(context,[grantedBytes,fs]);\r\n\t\t},context);\r\n\t}, errorHandler);\r\n}\r\nvar init=function(quota,cb,context) {\r\n\tif (!navigator.webkitPersistentStorage) return;\r\n\tnavigator.webkitPersistentStorage.requestQuota(quota,\r\n\t\t\tfunction(grantedBytes) {\r\n\t\t\t\tinitfs(grantedBytes,cb,context);\r\n\t\t}, errorHandler\r\n\t);\r\n}\r\nvar queryQuota=function(cb,context) {\r\n\tvar that=this;\r\n\tnavigator.webkitPersistentStorage.queryUsageAndQuota(\r\n\t function(usage,quota){\r\n\t\t\tinitfs(quota,function(){\r\n\t\t\t\tcb.apply(context,[usage,quota]);\r\n\t\t\t},context);\r\n\t});\r\n}\r\nvar API={\r\n\tinit:init\r\n\t,readdir:readdir\r\n\t,checkUpdate:checkUpdate\r\n\t,rm:rm\r\n\t,rmURL:rmURL\r\n\t,getFileURL:getFileURL\r\n\t,writeFile:writeFile\r\n\t,readFile:readFile\r\n\t,download:download\r\n\t,get_head:get_head\r\n\t,get_date:get_date\r\n\t,get_size:get_size\r\n\t,getDownloadSize:get_size\r\n\t,queryQuota:queryQuota\r\n}\r\nmodule.exports=API;\r\n",
    "var appname=\"installer\";\r\nif (typeof ksana==\"undefined\") {\r\n\twindow.ksana={platform:\"chrome\"};\r\n\tif (typeof process!==\"undefined\" && \r\n\t\tprocess.versions && process.versions[\"node-webkit\"]) {\r\n\t\twindow.ksana.platform=\"node-webkit\";\r\n\t}\r\n}\r\nvar switchApp=function(path) {\r\n\tvar fs=require(\"fs\");\r\n\tpath=\"../\"+path;\r\n\tappname=path;\r\n\tdocument.location.href= path+\"/index.html\"; \r\n\tprocess.chdir(path);\r\n}\r\nvar downloader={};\r\nvar rootPath=\"\";\r\n\r\nvar deleteApp=function(app) {\r\n\tconsole.error(\"not allow on PC, do it in File Explorer/ Finder\");\r\n}\r\nvar username=function() {\r\n\treturn \"\";\r\n}\r\nvar useremail=function() {\r\n\treturn \"\"\r\n}\r\nvar runtime_version=function() {\r\n\treturn \"1.4\";\r\n}\r\n\r\n//copy from liveupdate\r\nvar jsonp=function(url,dbid,callback,context) {\r\n  var script=document.getElementById(\"jsonp2\");\r\n  if (script) {\r\n    script.parentNode.removeChild(script);\r\n  }\r\n  window.jsonp_handler=function(data) {\r\n    if (typeof data==\"object\") {\r\n      data.dbid=dbid;\r\n      callback.apply(context,[data]);    \r\n    }  \r\n  }\r\n  window.jsonp_error_handler=function() {\r\n    console.error(\"url unreachable\",url);\r\n    callback.apply(context,[null]);\r\n  }\r\n  script=document.createElement('script');\r\n  script.setAttribute('id', \"jsonp2\");\r\n  script.setAttribute('onerror', \"jsonp_error_handler()\");\r\n  url=url+'?'+(new Date().getTime());\r\n  script.setAttribute('src', url);\r\n  document.getElementsByTagName('head')[0].appendChild(script); \r\n}\r\n\r\n\r\nvar loadKsanajs=function(){\r\n\r\n\tif (typeof process!=\"undefined\" && !process.browser) {\r\n\t\tvar ksanajs=require(\"fs\").readFileSync(\"./ksana.js\",\"utf8\").trim();\r\n\t\tdownloader=require(\"./downloader\");\r\n\t\tksana.js=JSON.parse(ksanajs.substring(14,ksanajs.length-1));\r\n\t\trootPath=process.cwd();\r\n\t\trootPath=require(\"path\").resolve(rootPath,\"..\").replace(/\\\\/g,\"/\")+'/';\r\n\t\tksana.ready=true;\r\n\t} else{\r\n\t\tvar url=window.location.origin+window.location.pathname.replace(\"index.html\",\"\")+\"ksana.js\";\r\n\t\tjsonp(url,appname,function(data){\r\n\t\t\tksana.js=data;\r\n\t\t\tksana.ready=true;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nloadKsanajs();\r\n\r\nvar boot=function(appId,cb) {\r\n\tif (typeof appId==\"function\") {\r\n\t\tcb=appId;\r\n\t\tappId=\"unknownapp\";\r\n\t}\r\n\tif (!ksana.js && ksana.platform==\"node-webkit\") {\r\n\t\tloadKsanajs();\r\n\t}\r\n\tksana.appId=appId;\r\n\tif (ksana.ready) {\r\n\t\tcb();\r\n\t\treturn;\r\n\t}\r\n\tvar timer=setInterval(function(){\r\n\t\t\tif (ksana.ready){\r\n\t\t\t\tclearInterval(timer);\r\n\t\t\t\tcb();\r\n\t\t\t}\r\n\t\t},100);\r\n}\r\n\r\n\r\nvar ksanagap={\r\n\tplatform:\"node-webkit\",\r\n\tstartDownload:downloader.startDownload,\r\n\tdownloadedByte:downloader.downloadedByte,\r\n\tdownloadingFile:downloader.downloadingFile,\r\n\tcancelDownload:downloader.cancelDownload,\r\n\tdoneDownload:downloader.doneDownload,\r\n\tswitchApp:switchApp,\r\n\trootPath:rootPath,\r\n\tdeleteApp: deleteApp,\r\n\tusername:username, //not support on PC\r\n\tuseremail:username,\r\n\truntime_version:runtime_version,\r\n\tboot:boot\r\n}\r\nmodule.exports=ksanagap;",
    "var started=false;\r\nvar timer=null;\r\nvar bundledate=null;\r\nvar get_date=require(\"./html5fs\").get_date;\r\nvar checkIfBundleUpdated=function() {\r\n\tget_date(\"bundle.js\",function(date){\r\n\t\tif (bundledate &&bundledate!=date){\r\n\t\t\tlocation.reload();\r\n\t\t}\r\n\t\tbundledate=date;\r\n\t});\r\n}\r\nvar livereload=function() {\r\n\tif(window.location.origin.indexOf(\"//127.0.0.1\")===-1) return;\r\n\r\n\tif (started) return;\r\n\r\n\ttimer1=setInterval(function(){\r\n\t\tcheckIfBundleUpdated();\r\n\t},2000);\r\n\tstarted=true;\r\n}\r\n\r\nmodule.exports=livereload;",
    "function mkdirP (p, mode, f, made) {\r\n     var path = nodeRequire('path');\r\n     var fs = nodeRequire('fs');\r\n\t\r\n    if (typeof mode === 'function' || mode === undefined) {\r\n        f = mode;\r\n        mode = 0x1FF & (~process.umask());\r\n    }\r\n    if (!made) made = null;\r\n\r\n    var cb = f || function () {};\r\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\r\n    p = path.resolve(p);\r\n\r\n    fs.mkdir(p, mode, function (er) {\r\n        if (!er) {\r\n            made = made || p;\r\n            return cb(null, made);\r\n        }\r\n        switch (er.code) {\r\n            case 'ENOENT':\r\n                mkdirP(path.dirname(p), mode, function (er, made) {\r\n                    if (er) cb(er, made);\r\n                    else mkdirP(p, mode, cb, made);\r\n                });\r\n                break;\r\n\r\n            // In the case of any other error, just see if there's a dir\r\n            // there already.  If so, then hooray!  If not, then something\r\n            // is borked.\r\n            default:\r\n                fs.stat(p, function (er2, stat) {\r\n                    // if the stat fails, then that's super weird.\r\n                    // let the original error be the failure reason.\r\n                    if (er2 || !stat.isDirectory()) cb(er, made)\r\n                    else cb(null, made);\r\n                });\r\n                break;\r\n        }\r\n    });\r\n}\r\n\r\nmkdirP.sync = function sync (p, mode, made) {\r\n    var path = nodeRequire('path');\r\n    var fs = nodeRequire('fs');\r\n    if (mode === undefined) {\r\n        mode = 0x1FF & (~process.umask());\r\n    }\r\n    if (!made) made = null;\r\n\r\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\r\n    p = path.resolve(p);\r\n\r\n    try {\r\n        fs.mkdirSync(p, mode);\r\n        made = made || p;\r\n    }\r\n    catch (err0) {\r\n        switch (err0.code) {\r\n            case 'ENOENT' :\r\n                made = sync(path.dirname(p), mode, made);\r\n                sync(p, mode, made);\r\n                break;\r\n\r\n            // In the case of any other error, just see if there's a dir\r\n            // there already.  If so, then hooray!  If not, then something\r\n            // is borked.\r\n            default:\r\n                var stat;\r\n                try {\r\n                    stat = fs.statSync(p);\r\n                }\r\n                catch (err1) {\r\n                    throw err0;\r\n                }\r\n                if (!stat.isDirectory()) throw err0;\r\n                break;\r\n        }\r\n    }\r\n\r\n    return made;\r\n};\r\n\r\nmodule.exports = mkdirP.mkdirp = mkdirP.mkdirP = mkdirP;\r\n"
  ]
}